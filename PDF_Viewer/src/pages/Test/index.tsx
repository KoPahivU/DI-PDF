import WebViewer from '@pdftron/webviewer';
import { useEffect, useRef } from 'react';

export function Test() {
  const viewerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    WebViewer(
      {
        path: '/lib/webviewer',
        licenseKey: 'demo:1748243908007:61f86d790300000000b53694e2aebb1c62c3d3148ee1cd8843885dbeb2',
        initialDoc: `https://res.cloudinary.com/dgfmpovjz/raw/upload/v1748576104/wyujh6ks8qog7c9qmuc6.pdf`,
      },
      viewerRef.current!,
    ).then(async (instance) => {
      const { annotationManager } = instance.Core;

      instance.Core.documentViewer.addEventListener('documentLoaded', async () => {
        const xfdf = `<?xml version="1.0" encoding="UTF-8" ?><xfdf xmlns="http://ns.adobe.com/xfdf/" xml:space="preserve"><annots><square page="0" rect="93.24,639.42,171.26,807.5" color="#000000" flags="print" name="b993a5a5-80c2-68ce-e452-7339fb8df96c" title="Guest" subject="Rectangle" date="D:20250530111715+07'00'" width="5" creationdate="D:20250530111710+07'00'" dashes=""/><square page="0" rect="205.27,674.43,229.28,716.46" color="#000000" flags="print" name="d82f182f-d0a9-1124-8db2-a71133e1c10a" title="Guest" subject="Rectangle" date="D:20250530111738+07'00'" interior-color="#000000" width="5" creationdate="D:20250530111738+07'00'" dashes=""/><square page="0" rect="70.23,732.46,140.25,810.5" color="#000000" flags="print" name="fa2b05f9-e154-3064-80d0-cb2f6c93c2f2" title="Guest" subject="Rectangle" date="D:20250530111816+07'00'" interior-color="#000000" width="5" creationdate="D:20250530111815+07'00'" dashes=""/><circle page="0" rect="60.23,583.39,175.26,646.42" color="#000000" flags="print" name="81b37977-8c24-3277-7ad9-b694193d0df5" title="Guest" subject="Ellipse" date="D:20250530111901+07'00'" width="5" creationdate="D:20250530111859+07'00'"/><circle page="0" rect="38.22,638.421,123.25,790.49" color="#000000" flags="print" name="18676caf-0b3a-7c62-5b17-4da7c64d473e" title="Guest" subject="Ellipse" date="D:20250530112534+07'00'" width="5" creationdate="D:20250530112533+07'00'"/><circle page="0" rect="560.38,696.45,569.38,784.49" color="#000000" flags="print" name="e72d1e18-0d22-29be-079f-b4bf6c13b83f" title="Guest" subject="Ellipse" date="D:20250530112602+07'00'" width="5" creationdate="D:20250530112601+07'00'"/><circle page="0" rect="210.27,730.46,212.27,822.51" color="#000000" flags="print" name="d0e386cf-9d4f-500f-30fa-4e3dab922eb0" title="Guest" subject="Ellipse" date="D:20250530112656+07'00'" width="5" creationdate="D:20250530112656+07'00'"/><square page="0" rect="106.24,634.41,230.28,826.51" color="#000000" flags="print" name="a9da8845-960c-2d17-1d27-be4c14698d8f" title="Guest" subject="Rectangle" date="D:20250530112717+07'00'" width="5" creationdate="D:20250530112717+07'00'" dashes=""/><square page="0" rect="296.3,697.42,492.36,802.49" color="#000000" flags="print" name="6a96ab70-3d54-6b42-5ce3-71991c9469fb" title="Guest" subject="Rectangle" date="D:20250530112738+07'00'" width="5" creationdate="D:20250530112737+07'00'" dashes=""/><circle page="0" rect="351.31,645.39,524.37,698.42" color="#000000" flags="print" name="5e7e8204-adc0-b770-e910-336c0e9de219" title="Guest" subject="Ellipse" date="D:20250530112743+07'00'" width="5" creationdate="D:20250530112743+07'00'"/><circle page="0" rect="392.33,695.421,539.37,779.48" color="#000000" flags="print" name="1aa6cd96-eb72-b08f-e9cc-950cf7f0ce6a" title="Guest" subject="Ellipse" date="D:20250530112801+07'00'" width="5" creationdate="D:20250530112800+07'00'"/><circle page="0" rect="148.25,475.21,331.31,600.29" color="#000000" flags="print" name="768e432b-780f-92ba-b827-a7eff2ca11d1" title="Guest" subject="Ellipse" date="D:20250530112838+07'00'" width="5" creationdate="D:20250530112838+07'00'"/><circle page="0" rect="268.29,644.19,404.33,715.23" color="#000000" flags="print" name="c24a882b-6c17-bd23-086e-9df1389b36fd" title="Guest" subject="Ellipse" date="D:20250530112933+07'00'" width="5" creationdate="D:20250530112933+07'00'"/><polygon page="0" rect="481.36,641.19,550.37,721.23" color="#000000" flags="print" name="5b3adc8d-bafb-e11e-1864-0e2bb3740214" title="Guest" subject="Polygon" date="D:20250530113010+07'00'" width="5" creationdate="D:20250530113007+07'00'"><vertices>545.37,716.23;486.36,646.1899999999999;540.37,647.1899999999999;545.37,716.23</vertices></polygon><square page="0" rect="5.21,693.79,46.22,799.6" color="#000000" flags="print" name="a447d75f-53b1-95f1-7c3c-eefd2e0fa8ca" title="Guest" subject="Rectangle" date="D:20250530113029+07'00'" interior-color="#000000" width="5" creationdate="D:20250530113029+07'00'" dashes=""/><line page="0" rect="554.38,709.25,568.38,814.301" color="#000000" flags="print" name="94815536-6f3b-f105-28f6-ab255c88b7e2" title="Guest" subject="Line" date="D:20250530113145+07'00'" width="5" creationdate="D:20250530113144+07'00'" start="559.38,714.25" end="563.38,809.3" head="None" tail="None"/><circle page="0" rect="42.22,590.39,369.321,638.42" color="#000000" flags="print" name="d4c8ab88-7494-d6f1-e0b7-93da1b107031" title="Guest" subject="Ellipse" date="D:20250530114238+07'00'" width="5" creationdate="D:20250530114237+07'00'"/></annots></xfdf>
index.tsx:465 Apply new:  <?xml version="1.0" encoding="UTF-8" ?><xfdf xmlns="http://ns.adobe.com/xfdf/" xml:space="preserve"><annots><square page="0" rect="93.24,639.42,171.26,807.5" color="#000000" flags="print" name="b993a5a5-80c2-68ce-e452-7339fb8df96c" title="Guest" subject="Rectangle" date="D:20250530111715+07'00'" width="5" creationdate="D:20250530111710+07'00'" dashes=""/><square page="0" rect="205.27,674.43,229.28,716.46" color="#000000" flags="print" name="d82f182f-d0a9-1124-8db2-a71133e1c10a" title="Guest" subject="Rectangle" date="D:20250530111738+07'00'" interior-color="#000000" width="5" creationdate="D:20250530111738+07'00'" dashes=""/><square page="0" rect="70.23,732.46,140.25,810.5" color="#000000" flags="print" name="fa2b05f9-e154-3064-80d0-cb2f6c93c2f2" title="Guest" subject="Rectangle" date="D:20250530111816+07'00'" interior-color="#000000" width="5" creationdate="D:20250530111815+07'00'" dashes=""/><circle page="0" rect="60.23,583.39,175.26,646.42" color="#000000" flags="print" name="81b37977-8c24-3277-7ad9-b694193d0df5" title="Guest" subject="Ellipse" date="D:20250530111901+07'00'" width="5" creationdate="D:20250530111859+07'00'"/><circle page="0" rect="38.22,638.421,123.25,790.49" color="#000000" flags="print" name="18676caf-0b3a-7c62-5b17-4da7c64d473e" title="Guest" subject="Ellipse" date="D:20250530112534+07'00'" width="5" creationdate="D:20250530112533+07'00'"/><circle page="0" rect="560.38,696.45,569.38,784.49" color="#000000" flags="print" name="e72d1e18-0d22-29be-079f-b4bf6c13b83f" title="Guest" subject="Ellipse" date="D:20250530112602+07'00'" width="5" creationdate="D:20250530112601+07'00'"/><circle page="0" rect="210.27,730.46,212.27,822.51" color="#000000" flags="print" name="d0e386cf-9d4f-500f-30fa-4e3dab922eb0" title="Guest" subject="Ellipse" date="D:20250530112656+07'00'" width="5" creationdate="D:20250530112656+07'00'"/><square page="0" rect="106.24,634.41,230.28,826.51" color="#000000" flags="print" name="a9da8845-960c-2d17-1d27-be4c14698d8f" title="Guest" subject="Rectangle" date="D:20250530112717+07'00'" width="5" creationdate="D:20250530112717+07'00'" dashes=""/><square page="0" rect="296.3,697.42,492.36,802.49" color="#000000" flags="print" name="6a96ab70-3d54-6b42-5ce3-71991c9469fb" title="Guest" subject="Rectangle" date="D:20250530112738+07'00'" width="5" creationdate="D:20250530112737+07'00'" dashes=""/><circle page="0" rect="351.31,645.39,524.37,698.42" color="#000000" flags="print" name="5e7e8204-adc0-b770-e910-336c0e9de219" title="Guest" subject="Ellipse" date="D:20250530112743+07'00'" width="5" creationdate="D:20250530112743+07'00'"/><circle page="0" rect="392.33,695.421,539.37,779.48" color="#000000" flags="print" name="1aa6cd96-eb72-b08f-e9cc-950cf7f0ce6a" title="Guest" subject="Ellipse" date="D:20250530112801+07'00'" width="5" creationdate="D:20250530112800+07'00'"/><circle page="0" rect="148.25,475.21,331.31,600.29" color="#000000" flags="print" name="768e432b-780f-92ba-b827-a7eff2ca11d1" title="Guest" subject="Ellipse" date="D:20250530112838+07'00'" width="5" creationdate="D:20250530112838+07'00'"/><circle page="0" rect="268.29,644.19,404.33,715.23" color="#000000" flags="print" name="c24a882b-6c17-bd23-086e-9df1389b36fd" title="Guest" subject="Ellipse" date="D:20250530112933+07'00'" width="5" creationdate="D:20250530112933+07'00'"/><polygon page="0" rect="481.36,641.19,550.37,721.23" color="#000000" flags="print" name="5b3adc8d-bafb-e11e-1864-0e2bb3740214" title="Guest" subject="Polygon" date="D:20250530113010+07'00'" width="5" creationdate="D:20250530113007+07'00'"><vertices>545.37,716.23;486.36,646.1899999999999;540.37,647.1899999999999;545.37,716.23</vertices></polygon><square page="0" rect="5.21,693.79,46.22,799.6" color="#000000" flags="print" name="a447d75f-53b1-95f1-7c3c-eefd2e0fa8ca" title="Guest" subject="Rectangle" date="D:20250530113029+07'00'" interior-color="#000000" width="5" creationdate="D:20250530113029+07'00'" dashes=""/><line page="0" rect="554.38,709.25,568.38,814.301" color="#000000" flags="print" name="94815536-6f3b-f105-28f6-ab255c88b7e2" title="Guest" subject="Line" date="D:20250530113145+07'00'" width="5" creationdate="D:20250530113144+07'00'" start="559.38,714.25" end="563.38,809.3" head="None" tail="None"/><circle page="0" rect="42.22,590.39,369.321,638.42" color="#000000" flags="print" name="d4c8ab88-7494-d6f1-e0b7-93da1b107031" title="Guest" subject="Ellipse" date="D:20250530114238+07'00'" width="5" creationdate="D:20250530114237+07'00'"/></annots></xfdf>`;
        await annotationManager.importAnnotations(xfdf);
      });

      console.log('Anno: ', await annotationManager.exportAnnotations());
    });
  }, []);

  return (
    <div
      ref={viewerRef}
      style={{
        flex: 1,
        overflowY: 'hidden',
      }}
    ></div>
  );
}
